<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CEO Lab — Deep Dive</title>
  <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg: #F7F3ED;
      --surface: #FFFFFF;
      --text: #1a1a1a;
      --text-60: rgba(26,26,26,0.6);
      --text-40: rgba(26,26,26,0.4);
      --text-25: rgba(26,26,26,0.25);
      --text-10: rgba(26,26,26,0.10);
      --text-06: rgba(26,26,26,0.06);
      --accent: #C8443C;
      --blue: #7FABC8;
      --green: #A6BEA4;
      --orange: #E08F6A;
      --mono: 'Space Mono', monospace;
      --sans: 'Inter', -apple-system, sans-serif;
    }

    body {
      font-family: var(--sans);
      background: var(--bg);
      color: var(--text);
      -webkit-font-smoothing: antialiased;
      font-weight: 400;
    }

    /* ─── Page shell ─── */
    .page {
      max-width: 960px;
      margin: 0 auto;
      padding: 80px 40px 120px;
    }

    /* ─── Section spacing ─── */
    .section { margin-bottom: 96px; }
    .section:last-child { margin-bottom: 0; }

    /* ─── Typography ─── */
    .mono-label {
      font-family: var(--mono);
      font-size: 10px;
      font-weight: 400;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--text-40);
    }

    .mono-label-strong {
      font-family: var(--mono);
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--text-40);
    }

    h1 {
      font-family: var(--sans);
      font-size: 13px;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--text);
    }

    h2 {
      font-family: var(--sans);
      font-size: 28px;
      font-weight: 600;
      letter-spacing: -0.02em;
      line-height: 1.2;
    }

    h3 {
      font-family: var(--sans);
      font-size: 18px;
      font-weight: 600;
      letter-spacing: -0.01em;
      line-height: 1.3;
    }

    .body-text {
      font-size: 14px;
      font-weight: 300;
      line-height: 1.7;
      color: var(--text-60);
      max-width: 480px;
    }

    .body-text-sm {
      font-size: 13px;
      font-weight: 300;
      line-height: 1.65;
      color: var(--text-40);
    }

    /* ─── Score numbers ─── */
    .score-lg {
      font-family: var(--mono);
      font-size: 42px;
      font-weight: 700;
      letter-spacing: -0.03em;
      line-height: 1;
    }

    .score-md {
      font-family: var(--mono);
      font-size: 28px;
      font-weight: 700;
      letter-spacing: -0.02em;
      line-height: 1;
    }

    .score-sm {
      font-family: var(--mono);
      font-size: 14px;
      font-weight: 700;
    }

    /* ─── Dividers ─── */
    .divider { height: 1px; background: var(--text-10); }
    .divider-strong { height: 1px; background: var(--text-25); }

    /* ─── Cards ─── */
    .card {
      background: var(--surface);
      border: 1px solid var(--text-10);
      padding: 40px;
    }

    .card-flush {
      background: var(--surface);
      border: 1px solid var(--text-10);
    }

    /* ─── Dot-on-line indicator (Bar San style) ─── */
    .dot-line {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 6px 0;
    }

    .dot-line-label {
      width: 160px;
      flex-shrink: 0;
      font-size: 13px;
      font-weight: 400;
      color: var(--text);
    }

    .dot-line-track {
      flex: 1;
      height: 1px;
      background: var(--text-10);
      position: relative;
    }

    .dot-line-track::before,
    .dot-line-track::after {
      content: '';
      position: absolute;
      top: -4px;
      width: 1px;
      height: 9px;
      background: var(--text-10);
    }
    .dot-line-track::before { left: 0; }
    .dot-line-track::after { right: 0; }

    .dot-line-ticks {
      position: absolute;
      top: -3px;
      width: 100%;
      height: 7px;
      pointer-events: none;
    }

    .dot-line-tick {
      position: absolute;
      top: 0;
      width: 1px;
      height: 7px;
      background: var(--text-10);
    }

    .dot-line-dot {
      position: absolute;
      top: 50%;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--text);
      transform: translate(-50%, -50%);
      transition: left 600ms ease-out;
    }

    .dot-line-dot.accent { background: var(--accent); }
    .dot-line-dot.blue { background: var(--blue); }
    .dot-line-dot.green { background: var(--green); }
    .dot-line-dot.orange { background: var(--orange); }

    .dot-line-value {
      width: 48px;
      flex-shrink: 0;
      text-align: right;
      font-family: var(--mono);
      font-size: 12px;
      font-weight: 700;
      color: var(--text);
    }

    .dot-line-meta {
      font-family: var(--mono);
      font-size: 10px;
      font-weight: 400;
      color: var(--text-25);
      letter-spacing: 0.04em;
    }

    /* ─── Territory header row ─── */
    .territory-header {
      display: flex;
      align-items: flex-end;
      justify-content: space-between;
      padding-bottom: 24px;
      border-bottom: 1px solid var(--text-10);
      margin-bottom: 32px;
    }

    /* ─── Territory overview grid ─── */
    .overview-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1px;
      background: var(--text-10);
    }

    .overview-grid > .overview-cell {
      background: var(--surface);
      padding: 40px 36px;
    }

    @media (max-width: 768px) {
      .overview-grid { grid-template-columns: 1fr; }
      .page { padding: 48px 20px 80px; }
      .card { padding: 28px 24px; }
      .dot-line-label { width: 120px; font-size: 12px; }
      .radar-layout { flex-direction: column; }
      .radar-col { max-width: 240px; margin: 0 auto; }
    }

    /* ─── Radar layout ─── */
    .radar-layout {
      display: flex;
      gap: 48px;
      align-items: flex-start;
    }

    .radar-col {
      flex: 0 0 220px;
    }
    .radar-col svg { width: 100%; height: auto; }

    .radar-info {
      flex: 1;
      padding-top: 8px;
    }

    /* ─── Stat pair ─── */
    .stat-pair {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px 40px;
    }

    .stat-label {
      font-size: 13px;
      font-weight: 500;
      color: var(--text);
      margin-bottom: 2px;
    }

    .stat-value {
      font-family: var(--mono);
      font-size: 12px;
      font-weight: 400;
      color: var(--text-40);
    }

    /* ─── Dimension detail card ─── */
    .dim-card {
      padding: 32px 0;
      border-bottom: 1px solid var(--text-06);
    }
    .dim-card:last-child { border-bottom: none; }

    .dim-card-head {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      margin-bottom: 20px;
    }

    /* ─── Badge ─── */
    .badge {
      font-family: var(--mono);
      font-size: 9px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      padding: 3px 8px;
      border: 1px solid var(--text-25);
      color: var(--text-40);
    }
    .badge.accent { border-color: var(--accent); color: var(--accent); }
    .badge.strength { border-color: var(--text); color: var(--text); }

    /* ─── Quarterly strip ─── */
    .q-strip { display: flex; gap: 1px; background: var(--text-06); }
    .q-cell {
      flex: 1;
      text-align: center;
      padding: 16px 8px;
      background: var(--bg);
    }
    .q-cell.q-now {
      background: var(--text);
      color: #fff;
    }
    .q-cell-label {
      font-family: var(--mono);
      font-size: 9px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      margin-bottom: 6px;
    }
    .q-cell-score {
      font-family: var(--mono);
      font-size: 20px;
      font-weight: 700;
      line-height: 1;
    }
    .q-cell-verbal {
      font-family: var(--mono);
      font-size: 9px;
      font-weight: 400;
      margin-top: 4px;
    }
    .q-delta {
      font-family: var(--mono);
      font-size: 9px;
      font-weight: 700;
      color: var(--accent);
      margin-top: 2px;
    }

    /* ─── Heatmap ─── */
    .heat-row {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 0;
      border-bottom: 1px solid var(--text-06);
    }
    .heat-row:last-child { border-bottom: none; }
    .heat-name { width: 180px; flex-shrink: 0; font-size: 13px; }
    .heat-bar-track { flex: 1; height: 16px; position: relative; }
    .heat-bar-fill { height: 100%; transition: width 500ms ease-out; }
    .heat-values {
      width: 140px; flex-shrink: 0;
      display: flex; align-items: center; justify-content: flex-end; gap: 12px;
    }
    .heat-pct { font-family: var(--mono); font-size: 12px; font-weight: 700; }
    .heat-label {
      font-family: var(--mono); font-size: 9px; font-weight: 400;
      text-transform: uppercase; letter-spacing: 0.08em; color: var(--text-25);
    }

    /* ─── Legend ─── */
    .legend-row {
      display: flex; flex-wrap: wrap; gap: 24px;
      padding-top: 20px;
      border-top: 1px solid var(--text-10);
    }
    .legend-item {
      font-family: var(--mono);
      font-size: 9px;
      font-weight: 400;
      color: var(--text-25);
      text-transform: uppercase;
      letter-spacing: 0.06em;
    }

    /* ─── Score arc (thin ring) ─── */
    .score-arc { display: inline-flex; flex-direction: column; align-items: center; }
    .score-arc-wrap { position: relative; }
    .score-arc svg { transform: rotate(-90deg); }
    .score-arc .arc-center {
      position: absolute; inset: 0;
      display: flex; align-items: center; justify-content: center;
      font-family: var(--mono); font-weight: 700; color: var(--text);
    }
    .score-arc circle.track { stroke: var(--text-06); }
    .score-arc circle.progress { transition: stroke-dashoffset 700ms ease-out; }

    /* ─── Flex helpers ─── */
    .flex-between { display: flex; align-items: center; justify-content: space-between; }
    .flex-start { display: flex; align-items: center; gap: 8px; }
    .flex-col { display: flex; flex-direction: column; }
  </style>
</head>
<body>

<div class="page" id="deep-dive"></div>

<script>
// ─── DATA ───────────────────────────────────────────────────────────

const TERRITORY_COLORS = {
  leading_yourself: 'blue',
  leading_teams: 'green',
  leading_organizations: 'orange',
};

const TERRITORY_HEX = {
  leading_yourself: '#7FABC8',
  leading_teams: '#A6BEA4',
  leading_organizations: '#E08F6A',
};

const TERRITORY_CONFIG = {
  leading_yourself: { displayLabel: 'Leading Yourself', arcDescription: 'See \u2192 Feel \u2192 Ground \u2192 Direct \u2192 Sustain' },
  leading_teams: { displayLabel: 'Leading Teams', arcDescription: 'Trust \u2192 Truth \u2192 Diagnosis \u2192 System \u2192 Identity' },
  leading_organizations: { displayLabel: 'Leading Organizations', arcDescription: 'See \u2192 Shape \u2192 Build \u2192 Evolve \u2192 Change' },
};

const DIMENSIONS = [
  { id: 'LY.1', name: 'Self-Awareness', territory: 'leading_yourself' },
  { id: 'LY.2', name: 'Emotional Mastery', territory: 'leading_yourself' },
  { id: 'LY.3', name: 'Grounded Presence', territory: 'leading_yourself' },
  { id: 'LY.4', name: 'Purpose & Mastery', territory: 'leading_yourself' },
  { id: 'LY.5', name: 'Peak Performance', territory: 'leading_yourself' },
  { id: 'LT.1', name: 'Building Trust', territory: 'leading_teams' },
  { id: 'LT.2', name: 'Hard Conversations', territory: 'leading_teams' },
  { id: 'LT.3', name: 'Diagnosing the Real Problem', territory: 'leading_teams' },
  { id: 'LT.4', name: 'Team Operating System', territory: 'leading_teams' },
  { id: 'LT.5', name: 'Leader Identity', territory: 'leading_teams' },
  { id: 'LO.1', name: 'Strategic Clarity', territory: 'leading_organizations' },
  { id: 'LO.2', name: 'Culture Design', territory: 'leading_organizations' },
  { id: 'LO.3', name: 'Organizational Architecture', territory: 'leading_organizations' },
  { id: 'LO.4', name: 'CEO Evolution', territory: 'leading_organizations' },
  { id: 'LO.5', name: 'Leading Change', territory: 'leading_organizations' },
];

const DIMENSION_BENCHMARKS = {
  'LY.1': { p25: 38, p50: 52, p75: 68 },
  'LY.2': { p25: 35, p50: 48, p75: 64 },
  'LY.3': { p25: 30, p50: 44, p75: 60 },
  'LY.4': { p25: 42, p50: 56, p75: 72 },
  'LY.5': { p25: 32, p50: 46, p75: 62 },
  'LT.1': { p25: 40, p50: 54, p75: 70 },
  'LT.2': { p25: 33, p50: 47, p75: 63 },
  'LT.3': { p25: 36, p50: 50, p75: 66 },
  'LT.4': { p25: 30, p50: 44, p75: 60 },
  'LT.5': { p25: 34, p50: 48, p75: 64 },
  'LO.1': { p25: 44, p50: 58, p75: 74 },
  'LO.2': { p25: 32, p50: 46, p75: 62 },
  'LO.3': { p25: 28, p50: 42, p75: 58 },
  'LO.4': { p25: 30, p50: 44, p75: 60 },
  'LO.5': { p25: 34, p50: 48, p75: 64 },
};

const TERRITORY_ARC_NARRATIVES = {
  leading_yourself: {
    critical: 'The inner foundation needs attention. Without this, everything else is built on shifting ground.',
    building: "You're building self-knowledge, but it hasn't yet become consistent practice under pressure.",
    strong: 'You have a solid inner foundation. The opportunity is deepening it into the kind of presence your team can feel.',
    mastery: 'Your inner work is genuinely strong. This is rare among CEOs and it shows in how people experience you.',
  },
  leading_teams: {
    critical: 'Your team likely feels the gap between your intentions and their daily experience.',
    building: "You care about your team and it shows, but the systems and conversations that make teams great aren't yet in place.",
    strong: "Your team is well-led. The next level is the difference between a team that performs and a team that thrives without you.",
    mastery: "You've built something rare: a team that functions as a genuine leadership collective.",
  },
  leading_organizations: {
    critical: "Your organization has outgrown its operating system. The structure that got you here won't take you there.",
    building: "You're beginning to think like an organizational architect, but the blueprints are still incomplete.",
    strong: "Your organization has real infrastructure. The opportunity now is in the places where strategy, culture, and structure don't yet align.",
    mastery: "You're building an organization that can outlast any individual, including you. That's the ultimate test of a CEO.",
  },
};

const SCORE_INSIGHTS = {
  'LY.1': { low: "Patterns are running you — you're reacting before you realize it.", mid: 'You see your patterns but they still drive you under pressure.', high: 'Strong self-awareness. Now model it — help your team see their own.' },
  'LY.2': { low: 'Emotions are either hijacking your decisions or being suppressed entirely.', mid: 'You manage emotions in calm moments but lose precision under stress.', high: 'You navigate emotions well. Your team reads your composure as safety.' },
  'LY.3': { low: 'Constant reactivity is clouding your judgment. Stillness is a skill to build.', mid: "You can find calm but it's fragile. Pressure still pulls you off center.", high: 'You stay grounded under fire. This is the foundation of everything else.' },
  'LY.4': { low: "You're spending time on things anyone could do. Your zone of genius is unprotected.", mid: "You know what matters but aren't fully committed to it yet.", high: "Clear purpose drives your decisions. You're building something only you can build." },
  'LY.5': { low: "You're burning capacity that you'll need later. This is a sustainability risk.", mid: 'You protect your energy sometimes but let urgency override your boundaries.', high: "You've built systems to sustain performance. This is a competitive advantage." },
  'LT.1': { low: 'Truth is traveling slowly in your team. People are editing what they tell you.', mid: "Trust exists but isn't deep enough for real candor under pressure.", high: "Your team tells you the truth fast. That's the most valuable thing a leader can build." },
  'LT.2': { low: 'Avoided conversations are creating hidden debt. Problems are compounding.', mid: 'You have hard conversations but sometimes too late or too softly.', high: 'You address issues directly and early. Relationships grow from it, not despite it.' },
  'LT.3': { low: "You're solving symptoms. The real problems are one or two layers deeper.", mid: "You sense there's more beneath the surface but don't always dig deep enough.", high: 'You consistently find the root cause. Your team brings you the hard puzzles.' },
  'LT.4': { low: "Your team lacks clear rhythms. People don't know what's expected or when.", mid: "Basic structures exist but aren't consistent enough to create momentum.", high: "Your team runs on clear systems. You've freed yourself to think, not manage." },
  'LT.5': { low: "You're either too involved or too absent. Boundaries need definition.", mid: 'You know you should step back but struggle to let go of ownership.', high: "You've found the line between leading and doing. Your team feels autonomous." },
  'LO.1': { low: "Your strategy isn't clear enough for others to make decisions without you.", mid: "The vision is there but the choices about what NOT to do aren't sharp.", high: 'Crisp strategy. Your team makes the same decisions you would in your absence.' },
  'LO.2': { low: "Culture is happening to you, not being designed by you.", mid: "You care about culture but haven't codified it into observable behaviors.", high: "You've designed the invisible forces. Culture is a system, not a poster." },
  'LO.3': { low: "Your org structure reflects your past, not your future.", mid: 'Structure mostly works but creates friction at the seams between teams.', high: "Your organization is built for where you're going. Structure enables, not constrains." },
  'LO.4': { low: "The CEO your company needed last year isn't the one it needs next year.", mid: "You're growing but parts of your old operating mode are holding you back.", high: "You're actively becoming who your company needs next. That's rare and valuable." },
  'LO.5': { low: "Change is either too disruptive or not happening.", mid: 'You can drive change but sometimes break what was working in the process.', high: 'You balance preservation and innovation. Change lands without casualties.' },
};

// ─── SAMPLE SCORES ─────────────────────────────────────────────────

const SAMPLE_SCORES = {
  'LY.1': 62, 'LY.2': 48, 'LY.3': 35, 'LY.4': 71, 'LY.5': 44,
  'LT.1': 58, 'LT.2': 39, 'LT.3': 67, 'LT.4': 42, 'LT.5': 53,
  'LO.1': 73, 'LO.2': 38, 'LO.3': 29, 'LO.4': 55, 'LO.5': 46,
};

// ─── HELPERS ────────────────────────────────────────────────────────

function getVerbalLabel(pct) {
  if (pct <= 20) return 'Reactive';
  if (pct <= 40) return 'Awakening';
  if (pct <= 60) return 'Practicing';
  if (pct <= 80) return 'Consistent';
  return 'Mastered';
}

function getTerritoryArcNarrative(territory, score) {
  const n = TERRITORY_ARC_NARRATIVES[territory];
  if (score <= 40) return n.critical;
  if (score <= 60) return n.building;
  if (score <= 80) return n.strong;
  return n.mastery;
}

function getBenchmarkContext(dimId, score) {
  const b = DIMENSION_BENCHMARKS[dimId];
  if (score >= b.p75) return 'Top quartile';
  if (score >= b.p50) return 'Above median';
  if (score >= b.p25) return 'Typical range';
  return 'Growth area';
}

function analyzeTerritoryShape(dims, label) {
  const sorted = [...dims].sort((a, b) => b.percentage - a.percentage);
  const highest = sorted[0], lowest = sorted[sorted.length - 1];
  const range = highest.percentage - lowest.percentage;
  let shape = range < 15 ? 'balanced' : range <= 30 ? 'developing' : 'spiky';
  let narrative;
  if (shape === 'balanced') narrative = `Your ${label} profile is balanced — dimensions are developing at a similar pace. ${highest.name} leads slightly, with ${lowest.name} closest behind.`;
  else if (shape === 'developing') narrative = `Your ${label} profile is developing unevenly. ${highest.name} is your anchor at ${highest.percentage}%, while ${lowest.name} at ${lowest.percentage}% is holding the territory back.`;
  else narrative = `Your ${label} profile is spiky — a ${highest.percentage - lowest.percentage}-point gap between ${highest.name} and ${lowest.name}. The strength in ${highest.name} isn't translating to ${lowest.name} yet.`;
  return { shape, range: Math.round(range), anchor: highest, bottleneck: lowest, narrative };
}

function getDimPriorities(scores) {
  const sorted = [...scores].sort((a, b) => a.score - b.score);
  const result = {};
  sorted.slice(0, 3).forEach(d => { result[d.id] = 'growth'; });
  sorted.slice(-3).forEach(d => { result[d.id] = 'strength'; });
  sorted.forEach(d => {
    if (!result[d.id] && d.score >= 45 && d.score <= 60) result[d.id] = 'quick-win';
  });
  return result;
}

function getQuarterlyProjection(score) {
  const quarters = [{ q: 'Now', score, isNow: true }];
  let prev = score;
  for (let i = 2; i <= 4; i++) {
    const growth = Math.round((100 - prev) * 0.2);
    const next = Math.min(100, prev + Math.max(growth, 2));
    quarters.push({ q: `Q${i}`, score: next, isNow: false });
    prev = next;
  }
  return quarters;
}

function getScoreInsight(dimId, score) {
  const d = SCORE_INSIGHTS[dimId];
  if (!d) return '';
  if (score < 40) return d.low;
  if (score < 65) return d.mid;
  return d.high;
}

// ─── BUILD DATA ─────────────────────────────────────────────────────

const enrichedDims = DIMENSIONS.map(d => ({
  ...d,
  score: SAMPLE_SCORES[d.id],
  label: getVerbalLabel(SAMPLE_SCORES[d.id]),
}));

const territories = ['leading_yourself', 'leading_teams', 'leading_organizations'];

const territoryScores = territories.map(t => {
  const dims = enrichedDims.filter(d => d.territory === t);
  const avg = dims.reduce((s, d) => s + d.score, 0) / dims.length;
  return { territory: t, score: Math.round(avg), verbalLabel: getVerbalLabel(avg) };
});

const priorities = getDimPriorities(enrichedDims);

// ─── SVG HELPERS ────────────────────────────────────────────────────

function polarToCartesian(cx, cy, r, angleDeg) {
  const rad = ((angleDeg - 90) * Math.PI) / 180;
  return { x: cx + r * Math.cos(rad), y: cy + r * Math.sin(rad) };
}

function pentagonPoints(cx, cy, r) {
  return Array.from({ length: 5 }, (_, i) => {
    const p = polarToCartesian(cx, cy, r, i * 72);
    return `${p.x},${p.y}`;
  }).join(' ');
}

function scoreArcSVG(value, size, strokeW) {
  const r = (size - strokeW) / 2;
  const circ = 2 * Math.PI * r;
  const offset = circ - (value / 100) * circ;
  const c = size / 2;
  const fs = size * 0.26;
  return `
    <div class="score-arc">
      <div class="score-arc-wrap" style="width:${size}px;height:${size}px">
        <svg width="${size}" height="${size}" viewBox="0 0 ${size} ${size}">
          <circle class="track" cx="${c}" cy="${c}" r="${r}" fill="none" stroke-width="${strokeW}"/>
          <circle class="progress" cx="${c}" cy="${c}" r="${r}" fill="none"
            stroke="var(--text)" stroke-width="${strokeW}" stroke-linecap="round"
            stroke-dasharray="${circ}" stroke-dashoffset="${offset}"/>
        </svg>
        <div class="arc-center" style="font-size:${fs}px">${Math.round(value)}</div>
      </div>
    </div>`;
}

function radarSVG(dims, territoryColor) {
  const VB = 300, cx = 150, cy = 150, maxR = 110;
  const hex = territoryColor;
  const fillColor = hex + '15';

  let svg = `<svg viewBox="0 0 ${VB} ${VB}" preserveAspectRatio="xMidYMid meet" style="overflow:visible">`;

  // Concentric pentagons
  for (let i = 1; i <= 5; i++) {
    const r = (i / 5) * maxR;
    svg += `<polygon points="${pentagonPoints(cx, cy, r)}" fill="none"
      stroke="rgba(26,26,26,0.06)" stroke-width="0.5" ${i < 5 ? 'stroke-dasharray="3 3"' : ''}/>`;
  }

  // Axis lines
  for (let i = 0; i < 5; i++) {
    const p = polarToCartesian(cx, cy, maxR, i * 72);
    svg += `<line x1="${cx}" y1="${cy}" x2="${p.x}" y2="${p.y}"
      stroke="rgba(26,26,26,0.04)" stroke-width="0.5"/>`;
  }

  // Score polygon
  const pts = dims.map((d, i) => {
    const r = (d.percentage / 100) * maxR;
    return polarToCartesian(cx, cy, r, i * 72);
  });
  svg += `<polygon points="${pts.map(p => `${p.x},${p.y}`).join(' ')}"
    fill="${fillColor}" stroke="${hex}" stroke-width="1.5" stroke-linejoin="round" opacity="0.9"/>`;

  // Dots
  pts.forEach((p, i) => {
    const isLowest = dims[i].percentage === Math.min(...dims.map(d => d.percentage));
    if (isLowest) {
      svg += `<circle cx="${p.x}" cy="${p.y}" r="5" fill="${hex}" opacity="0.25"/>`;
      svg += `<circle cx="${p.x}" cy="${p.y}" r="3" fill="${hex}"/>`;
    } else {
      svg += `<circle cx="${p.x}" cy="${p.y}" r="3" fill="${hex}"/>`;
    }
  });

  // Labels
  dims.forEach((d, i) => {
    const angle = i * 72;
    const lp = polarToCartesian(cx, cy, maxR + 20, angle);
    const norm = ((angle - 90 + 360) % 360);
    let anchor = 'middle';
    if (norm > 15 && norm < 165) anchor = 'start';
    else if (norm > 195 && norm < 345) anchor = 'end';
    const short = d.name.length > 16 ? d.name.split(' ').slice(0, 2).join(' ') : d.name;
    svg += `<text x="${lp.x}" y="${lp.y}" text-anchor="${anchor}" dominant-baseline="central"
      fill="rgba(26,26,26,0.35)" font-size="9" font-weight="400"
      font-family="'Space Mono', monospace">${short}</text>`;
  });

  svg += '</svg>';
  return svg;
}

// ─── DOT-LINE HTML ──────────────────────────────────────────────────

function dotLineHTML(label, score, dotClass, benchmarks) {
  const ticks = [25, 50, 75].map(pos =>
    `<div class="dot-line-tick" style="left:${pos}%"></div>`
  ).join('');

  const benchmarkDots = benchmarks ? `
    <div style="position:absolute;top:50%;left:${benchmarks.p25}%;width:6px;height:6px;border-radius:50%;background:var(--text-10);transform:translate(-50%,-50%)"></div>
    <div style="position:absolute;top:50%;left:${benchmarks.p75}%;width:6px;height:6px;border-radius:50%;background:var(--text-10);transform:translate(-50%,-50%)"></div>
  ` : '';

  return `
    <div class="dot-line">
      <div class="dot-line-label">${label}</div>
      <div class="dot-line-track">
        <div class="dot-line-ticks">${ticks}</div>
        ${benchmarkDots}
        <div class="dot-line-dot ${dotClass}" style="left:${score}%"></div>
      </div>
      <div class="dot-line-value">${score}%</div>
    </div>`;
}

// ─── RENDER ─────────────────────────────────────────────────────────

function render() {
  const root = document.getElementById('deep-dive');
  let html = '';

  // ══════════════════════════════════════════════════════════════════
  // HEADER
  // ══════════════════════════════════════════════════════════════════

  html += `
    <div style="margin-bottom:80px">
      <h1 style="margin-bottom:8px">CEO Lab</h1>
      <div class="mono-label" style="margin-top:4px">Deep Dive · Leadership Assessment</div>
    </div>`;

  // ══════════════════════════════════════════════════════════════════
  // SECTION 1: Territory Overview — 3-column grid (card style)
  // ══════════════════════════════════════════════════════════════════

  html += `<div class="section">
    <div class="overview-grid">`;

  territoryScores.forEach(ts => {
    const cfg = TERRITORY_CONFIG[ts.territory];
    const narrative = getTerritoryArcNarrative(ts.territory, ts.score);
    const hex = TERRITORY_HEX[ts.territory];

    html += `
      <div class="overview-cell">
        <div class="mono-label" style="margin-bottom:24px">${cfg.arcDescription}</div>
        <h3 style="margin-bottom:20px">${cfg.displayLabel}</h3>
        <div style="display:flex;align-items:flex-end;gap:12px;margin-bottom:24px">
          <span class="score-lg" style="color:${hex}">${ts.score}</span>
          <span class="mono-label" style="margin-bottom:6px">${ts.verbalLabel}</span>
        </div>
        <p class="body-text-sm">${narrative}</p>
      </div>`;
  });

  html += '</div></div>';

  // ══════════════════════════════════════════════════════════════════
  // SECTION 2: Territory Deep Dives
  // ══════════════════════════════════════════════════════════════════

  territories.forEach((t, ti) => {
    const cfg = TERRITORY_CONFIG[t];
    const ts = territoryScores.find(x => x.territory === t);
    const hex = TERRITORY_HEX[t];
    const colorClass = TERRITORY_COLORS[t];
    const dims = enrichedDims.filter(d => d.territory === t);
    const radarDims = dims.map(d => ({ name: d.name, percentage: d.score }));
    const shape = analyzeTerritoryShape(radarDims, cfg.displayLabel);
    const shapeLabel = shape.shape === 'balanced' ? 'Balanced'
      : shape.shape === 'developing' ? 'Developing' : 'Spiky';

    html += `
      <div class="section">
        <div class="territory-header">
          <div>
            <div class="mono-label" style="margin-bottom:8px">${cfg.arcDescription}</div>
            <h2>${cfg.displayLabel}</h2>
          </div>
          <div style="text-align:right">
            <span class="score-lg">${ts.score}</span>
            <div class="mono-label" style="margin-top:4px">${ts.verbalLabel} capacity</div>
          </div>
        </div>

        <div class="card" style="margin-bottom:40px">
          <div class="radar-layout">
            <div class="radar-col">
              ${radarSVG(radarDims, hex)}
            </div>
            <div class="radar-info">
              <div class="mono-label-strong" style="margin-bottom:12px">${shapeLabel} Profile</div>
              <p class="body-text" style="margin-bottom:24px">${shape.narrative}</p>
              <div class="stat-pair">
                <div>
                  <div class="stat-label">Anchor</div>
                  <div class="stat-value">${shape.anchor.name}, ${shape.anchor.percentage}%</div>
                </div>
                <div>
                  <div class="stat-label">Bottleneck</div>
                  <div class="stat-value">${shape.bottleneck.name}, ${shape.bottleneck.percentage}%</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div style="padding:0 4px">
          ${dims.map(dim => {
            const bench = DIMENSION_BENCHMARKS[dim.id];
            const benchCtx = getBenchmarkContext(dim.id, dim.score);
            return `
              <div style="margin-bottom:4px">
                ${dotLineHTML(dim.name, dim.score, colorClass, bench)}
                <div style="display:flex;justify-content:space-between;padding-left:176px">
                  <span class="dot-line-meta">Typical: ${bench.p25}–${bench.p75}%</span>
                  <span class="dot-line-meta" style="padding-right:64px">${benchCtx}</span>
                </div>
              </div>`;
          }).join('')}
        </div>
      </div>`;
  });

  // ══════════════════════════════════════════════════════════════════
  // SECTION 3: All 15 Dimensions Heatmap
  // ══════════════════════════════════════════════════════════════════

  html += `
    <div class="section">
      <div class="mono-label" style="margin-bottom:8px">All Dimensions</div>
      <h2 style="margin-bottom:40px">15 Dimensions</h2>`;

  territories.forEach(t => {
    const cfg = TERRITORY_CONFIG[t];
    const hex = TERRITORY_HEX[t];
    const dims = enrichedDims.filter(d => d.territory === t);

    html += `
      <div style="margin-bottom:32px">
        <div class="mono-label" style="margin-bottom:16px">${cfg.displayLabel}</div>
        <div>
          ${dims.map(d => {
            const opacity = 0.12 + (d.score / 100) * 0.88;
            return `
              <div class="heat-row">
                <div class="heat-name">${d.name}</div>
                <div class="heat-bar-track">
                  <div class="heat-bar-fill" style="width:${d.score}%;background:${hex};opacity:${opacity}"></div>
                </div>
                <div class="heat-values">
                  <span class="heat-pct">${d.score}%</span>
                  <span class="heat-label">${d.label}</span>
                </div>
              </div>`;
          }).join('')}
        </div>
      </div>`;
  });

  html += `
      <div class="legend-row">
        <span class="legend-item">0–20% Reactive</span>
        <span class="legend-item">21–40% Awakening</span>
        <span class="legend-item">41–60% Practicing</span>
        <span class="legend-item">61–80% Consistent</span>
        <span class="legend-item">81–100% Mastered</span>
      </div>
    </div>`;

  // ══════════════════════════════════════════════════════════════════
  // SECTION 4: Dimension Details
  // ══════════════════════════════════════════════════════════════════

  territories.forEach(t => {
    const cfg = TERRITORY_CONFIG[t];
    const ts = territoryScores.find(x => x.territory === t);
    const hex = TERRITORY_HEX[t];
    const dims = enrichedDims.filter(d => d.territory === t);

    html += `
      <div class="section">
        <div class="flex-start" style="gap:16px;margin-bottom:40px">
          ${scoreArcSVG(ts.score, 52, 2.5)}
          <div>
            <h3 style="font-size:17px">${cfg.displayLabel}</h3>
            <div class="mono-label">${ts.verbalLabel} · ${ts.score}% capacity</div>
          </div>
        </div>

        <div>
          ${dims.map(dim => {
            const priority = priorities[dim.id];
            const insight = getScoreInsight(dim.id, dim.score);
            const quarters = getQuarterlyProjection(dim.score);
            const isLow = dim.score < 40;

            let badgeHTML = '';
            if (priority === 'growth') badgeHTML = '<span class="badge accent">Growth Area</span>';
            else if (priority === 'strength') badgeHTML = '<span class="badge strength">Strength</span>';
            else if (priority === 'quick-win') badgeHTML = '<span class="badge">Near Breakthrough</span>';

            const qHTML = quarters.map((qd, qi) => {
              const vLabel = getVerbalLabel(qd.score);
              const delta = qi > 0 ? qd.score - quarters[qi - 1].score : 0;

              if (qd.isNow) {
                return `<div class="q-cell q-now">
                  <div class="q-cell-label" style="opacity:0.6">Now</div>
                  <div class="q-cell-score">${qd.score}%</div>
                  <div class="q-cell-verbal" style="opacity:0.4">${vLabel}</div>
                </div>`;
              }

              const fade = qi === 1 ? 0.35 : qi === 2 ? 0.22 : 0.12;
              return `<div class="q-cell" style="opacity:${fade + 0.3}">
                <div class="q-cell-label">${qd.q}</div>
                <div class="q-cell-score">${qd.score}%</div>
                <div class="q-cell-verbal">${vLabel}</div>
                ${delta > 0 ? `<div class="q-delta">+${delta}</div>` : ''}
              </div>`;
            }).join('');

            return `
              <div class="dim-card">
                <div class="dim-card-head">
                  <div class="flex-start" style="flex-wrap:wrap;gap:10px">
                    <span style="font-size:15px;font-weight:500">${dim.name}</span>
                    ${badgeHTML}
                  </div>
                  <span class="score-sm" style="font-size:17px">${dim.score}%</span>
                </div>

                <div style="height:1px;background:var(--text-06);position:relative;margin-bottom:24px">
                  <div style="position:absolute;top:-1px;left:0;height:3px;width:${Math.max(1, dim.score)}%;background:${isLow ? 'var(--accent)' : hex};transition:width 600ms ease-out"></div>
                </div>

                <div class="q-strip" style="margin-bottom:20px">
                  ${qHTML}
                </div>

                <p class="body-text-sm">${insight}</p>
              </div>`;
          }).join('')}
        </div>
      </div>`;
  });

  // ══════════════════════════════════════════════════════════════════
  // FOOTER
  // ══════════════════════════════════════════════════════════════════

  html += `
    <div style="padding-top:48px;border-top:1px solid var(--text-10)">
      <div class="mono-label">CEO Lab · Deep Dive Assessment</div>
      <div class="body-text-sm" style="margin-top:8px">Scores reflect capacity, not character. Every dimension can be developed with deliberate practice.</div>
    </div>`;

  root.innerHTML = html;
}

render();
</script>

</body>
</html>
